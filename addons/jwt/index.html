
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation for the official Authentication and Authorization framework for CodeIgniter 4">
      
      
      
      
        <link rel="prev" href="../../guides/strengthen_password/">
      
      
      <link rel="icon" href="../../assets/favicon.ico">
      <meta name="generator" content="mkdocs-1.4.3, mkdocs-material-9.1.13">
    
    
      
        <title>JWT Authentication - CodeIgniter Shield</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.85bb2934.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.a6bdf11c.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Raleway";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.6.0/build/styles/github.min.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="deep-orange" data-md-color-accent="indigo">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#jwt-authentication" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="https://codeigniter.com" title="CodeIgniter Shield" class="md-header__button md-logo" aria-label="CodeIgniter Shield" data-md-component="logo">
      
  <img src="../../assets/flame.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            CodeIgniter Shield
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              JWT Authentication
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/codeigniter4/shield" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://codeigniter.com" title="CodeIgniter Shield" class="md-nav__button md-logo" aria-label="CodeIgniter Shield" data-md-component="logo">
      
  <img src="../../assets/flame.svg" alt="logo">

    </a>
    CodeIgniter Shield
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/codeigniter4/shield" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../install/" class="md-nav__link">
        Installation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/" class="md-nav__link">
        Concepts
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../quickstart/" class="md-nav__link">
        Quick Start Guide
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../authentication/" class="md-nav__link">
        Authentication
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../authorization/" class="md-nav__link">
        Authorization
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../auth_actions/" class="md-nav__link">
        Auth Actions
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../events/" class="md-nav__link">
        Events
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../testing/" class="md-nav__link">
        Testing
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../customization/" class="md-nav__link">
        Customization
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../forcing_password_reset/" class="md-nav__link">
        Forcing Password Reset
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../banning_users/" class="md-nav__link">
        Banning Users
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../session_auth_event_and_logging/" class="md-nav__link">
        Session Authenticator Event and Logging
      </a>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_14" >
      
      
      
        <label class="md-nav__link" for="__nav_14" id="__nav_14_label" tabindex="0">
          Guides
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_14_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_14">
          <span class="md-nav__icon md-icon"></span>
          Guides
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/api_tokens/" class="md-nav__link">
        Protecting an API with Access Tokens
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/mobile_apps/" class="md-nav__link">
        Mobile Authentication with Access Tokens
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/strengthen_password/" class="md-nav__link">
        How to Strengthen the Password
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_15" checked>
      
      
      
        <label class="md-nav__link" for="__nav_15" id="__nav_15_label" tabindex="0">
          Addons
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_15_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_15">
          <span class="md-nav__icon md-icon"></span>
          Addons
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          JWT Authentication
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        JWT Authentication
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#what-is-jwt" class="md-nav__link">
    What is JWT?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setup" class="md-nav__link">
    Setup
  </a>
  
    <nav class="md-nav" aria-label="Setup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#manual-setup" class="md-nav__link">
    Manual Setup
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    Configuration
  </a>
  
    <nav class="md-nav" aria-label="Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#set-the-default-claims" class="md-nav__link">
    Set the Default Claims
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set-secret-key" class="md-nav__link">
    Set Secret Key
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#issuing-jwts" class="md-nav__link">
    Issuing JWTs
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#protecting-routes" class="md-nav__link">
    Protecting Routes
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#method-references" class="md-nav__link">
    Method References
  </a>
  
    <nav class="md-nav" aria-label="Method References">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#generating-signed-jwts" class="md-nav__link">
    Generating Signed JWTs
  </a>
  
    <nav class="md-nav" aria-label="Generating Signed JWTs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#jwt-to-a-specific-user" class="md-nav__link">
    JWT to a Specific User
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#arbitrary-jwt" class="md-nav__link">
    Arbitrary JWT
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#what-is-jwt" class="md-nav__link">
    What is JWT?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setup" class="md-nav__link">
    Setup
  </a>
  
    <nav class="md-nav" aria-label="Setup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#manual-setup" class="md-nav__link">
    Manual Setup
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    Configuration
  </a>
  
    <nav class="md-nav" aria-label="Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#set-the-default-claims" class="md-nav__link">
    Set the Default Claims
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set-secret-key" class="md-nav__link">
    Set Secret Key
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#issuing-jwts" class="md-nav__link">
    Issuing JWTs
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#protecting-routes" class="md-nav__link">
    Protecting Routes
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#method-references" class="md-nav__link">
    Method References
  </a>
  
    <nav class="md-nav" aria-label="Method References">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#generating-signed-jwts" class="md-nav__link">
    Generating Signed JWTs
  </a>
  
    <nav class="md-nav" aria-label="Generating Signed JWTs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#jwt-to-a-specific-user" class="md-nav__link">
    JWT to a Specific User
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#arbitrary-jwt" class="md-nav__link">
    Arbitrary JWT
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="jwt-authentication">JWT Authentication</h1>
<blockquote>
<p><strong>Note</strong>
Shield now supports only JWS (Singed JWT). JWE (Encrypted JWT) is not supported.</p>
</blockquote>
<h2 id="what-is-jwt">What is JWT?</h2>
<p>JWT or JSON Web Token is a compact and self-contained way of securely transmitting
information between parties as a JSON object. It is commonly used for authentication
and authorization purposes in web applications.</p>
<p>For example, when a user logs in to a web application, the server generates a JWT
token and sends it to the client. The client then includes this token in the header
of subsequent requests to the server. The server verifies the authenticity of the
token and grants access to protected resources accordingly.</p>
<p>If you are not familiar with JWT, we recommend that you check out
<a href="https://jwt.io/introduction">Introduction to JSON Web Tokens</a> before continuing.</p>
<h2 id="setup">Setup</h2>
<p>To use JWT Authentication, you need additional setup and configuration.</p>
<h3 id="manual-setup">Manual Setup</h3>
<ol>
<li>
<p>Install "firebase/php-jwt" via Composer.</p>
<pre class="highlight"><code class="language-console">composer require firebase/php-jwt:^6.4</code></pre>
</li>
<li>
<p>Copy the <strong>AuthJWT.php</strong> from <strong>vendor/codeigniter4/shield/src/Config/</strong> into your project's config folder and update the namespace to <code>Config</code>. You will also need to have these classes extend the original classes. See the example below.</p>
<pre class="highlight"><code class="language-php">// new file - app/Config/AuthJWT.php
&lt;?php

declare(strict_types=1);

namespace Config;

use CodeIgniter\Shield\Config\AuthJWT as ShieldAuthJWT;

/**
 * JWT Authenticator Configuration
 */
class AuthJWT extends ShieldAuthJWT
{
    // ...
}</code></pre>
</li>
<li>
<p>If your <strong>app/Config/Auth.php</strong> is not up-to-date, you also need to update it. Check <strong>vendor/codeigniter4/shield/src/Config/Auth.php</strong> and apply the differences.</p>
<p>You need to add the following constants:
<pre class="highlight"><code class="language-php">    public const RECORD_LOGIN_ATTEMPT_NONE    = 0; // Do not record at all
    public const RECORD_LOGIN_ATTEMPT_FAILURE = 1; // Record only failures
    public const RECORD_LOGIN_ATTEMPT_ALL     = 2; // Record all login attempts</code></pre></p>
<p>You need to add JWT Authenticator:
<pre class="highlight"><code class="language-php">use CodeIgniter\Shield\Authentication\Authenticators\JWT;

// ...

    public array $authenticators = [
        'tokens'  =&gt; AccessTokens::class,
        'session' =&gt; Session::class,
        'jwt'     =&gt; JWT::class,
    ];</code></pre></p>
<p>If you want to use JWT Authenticator in Authentication Chain, add <code>jwt</code>:
<pre class="highlight"><code class="language-php">    public array $authenticationChain = [
        'session',
        'tokens',
        'jwt'
    ];</code></pre></p>
</li>
</ol>
<h2 id="configuration">Configuration</h2>
<p>Configure <strong>app/Config/AuthJWT.php</strong> for your needs.</p>
<h3 id="set-the-default-claims">Set the Default Claims</h3>
<blockquote>
<p><strong>Note</strong>
A payload contains the actual data being transmitted, such as user ID, role,
or expiration time. Items in a payload is called <em>claims</em>.</p>
</blockquote>
<p>Set the default payload items to the property <code>$defaultClaims</code>.</p>
<p>E.g.:
<pre class="highlight"><code class="language-php">    public array $defaultClaims = [
        'iss' =&gt; 'https://codeigniter.com/',
    ];</code></pre></p>
<p>The default claims will be included in all tokens issued by Shield.</p>
<h3 id="set-secret-key">Set Secret Key</h3>
<p>Set your secret key in the <code>$keys</code> property, or set it in your <code>.env</code> file.</p>
<p>E.g.:
<pre class="highlight"><code class="language-dotenv">authjwt.keys.default.0.secret = 8XBFsF6HThIa7OV/bSynahEch+WbKrGcuiJVYPiwqPE=</code></pre></p>
<p>It needs at least 256 bits random string. The length of the secret depends on the
algorithm we use. The default one is <code>HS256</code>, so to ensure that the hash value is
secure and not easily guessable, the secret key should be at least as long as the
hash function's output - 256 bits (32 bytes). You can get a secure random string
with the following command:</p>
<pre class="highlight"><code class="language-console">php -r 'echo base64_encode(random_bytes(32));'</code></pre>
<blockquote>
<p><strong>Note</strong>
The secret key is used for signing and validating tokens.</p>
</blockquote>
<h2 id="issuing-jwts">Issuing JWTs</h2>
<p>To use JWT Authentication, you need a controller that issues JWTs.</p>
<p>Here is a sample controller. When a client posts valid credentials (email/password),
it returns a new JWT.</p>
<pre class="highlight"><code class="language-php">// app/Config/Routes.php
$routes-&gt;post('auth/jwt', '\App\Controllers\Auth\LoginController::jwtLogin');</code></pre>
<pre class="highlight"><code class="language-php">// app/Controllers/Auth/LoginController.php
declare(strict_types=1);

namespace App\Controllers\Auth;

use App\Controllers\BaseController;
use CodeIgniter\API\ResponseTrait;
use CodeIgniter\HTTP\ResponseInterface;
use CodeIgniter\Shield\Authentication\Authenticators\Session;
use CodeIgniter\Shield\Authentication\JWTManager;
use CodeIgniter\Shield\Authentication\Passwords;
use CodeIgniter\Shield\Config\AuthSession;

class LoginController extends BaseController
{
    use ResponseTrait;

    /**
     * Authenticate Existing User and Issue JWT.
     */
    public function jwtLogin(): ResponseInterface
    {
        // Get the validation rules
        $rules = $this-&gt;getValidationRules();

        // Validate credentials
        if (! $this-&gt;validateData($this-&gt;request-&gt;getJSON(true), $rules)) {
            return $this-&gt;fail(
                ['errors' =&gt; $this-&gt;validator-&gt;getErrors()],
                $this-&gt;codes['unauthorized']
            );
        }

        // Get the credentials for login
        $credentials             = $this-&gt;request-&gt;getJsonVar(setting('Auth.validFields'));
        $credentials             = array_filter($credentials);
        $credentials['password'] = $this-&gt;request-&gt;getJsonVar('password');

        /** @var Session $authenticator */
        $authenticator = auth('session')-&gt;getAuthenticator();

        // Check the credentials
        $result = $authenticator-&gt;check($credentials);

        // Credentials mismatch.
        if (! $result-&gt;isOK()) {
            // @TODO Record a failed login attempt

            return $this-&gt;failUnauthorized($result-&gt;reason());
        }

        // Credentials match.
        // @TODO Record a successful login attempt

        $user = $result-&gt;extraInfo();

        /** @var JWTManager $manager */
        $manager = service('jwtmanager');

        // Generate JWT and return to client
        $jwt = $manager-&gt;generateToken($user);

        return $this-&gt;respond([
            'access_token' =&gt; $jwt,
        ]);
    }

    /**
     * Returns the rules that should be used for validation.
     *
     * @return array&lt;string, array&lt;string, array&lt;string&gt;|string&gt;&gt;
     * @phpstan-return array&lt;string, array&lt;string, string|list&lt;string&gt;&gt;&gt;
     */
    protected function getValidationRules(): array
    {
        return setting('Validation.login') ?? [
            'email' =&gt; [
                'label' =&gt; 'Auth.email',
                'rules' =&gt; config(AuthSession::class)-&gt;emailValidationRules,
            ],
            'password' =&gt; [
                'label'  =&gt; 'Auth.password',
                'rules'  =&gt; 'required|' . Passwords::getMaxLenghtRule(),
                'errors' =&gt; [
                    'max_byte' =&gt; 'Auth.errorPasswordTooLongBytes',
                ],
            ],
        ];
    }
}</code></pre>
<p>You could send a request with the existing user's credentials by curl like this:</p>
<pre class="highlight"><code class="language-console">curl --location 'http://localhost:8080/auth/jwt' \
--header 'Content-Type: application/json' \
--data-raw '{"email" : "admin@example.jp" , "password" : "passw0rd!"}'</code></pre>
<p>When making all future requests to the API, the client should send the JWT in
the <code>Authorization</code> header as a <code>Bearer</code> token.</p>
<p>You could send a request with the <code>Authorization</code> header by curl like this:</p>
<pre class="highlight"><code class="language-console">curl --location --request GET 'http://localhost:8080/api/users' \
--header 'Authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJTaGllbGQgVGVzdCBBcHAiLCJzdWIiOiIxIiwiaWF0IjoxNjgxODA1OTMwLCJleHAiOjE2ODE4MDk1MzB9.DGpOmRPOBe45whVtEOSt53qJTw_CpH0V8oMoI_gm2XI'</code></pre>
<h2 id="protecting-routes">Protecting Routes</h2>
<p>The first way to specify which routes are protected is to use the <code>jwt</code> controller
filter.</p>
<p>For example, to ensure it protects all routes under the <code>/api</code> route group, you
would use the <code>$filters</code> setting on <strong>app/Config/Filters.php</strong>.</p>
<pre class="highlight"><code class="language-php">public $filters = [
    'jwt' =&gt; ['before' =&gt; ['api', 'api/*']],
];</code></pre>
<p>You can also specify the filter should run on one or more routes within the routes
file itself:</p>
<pre class="highlight"><code class="language-php">$routes-&gt;group('api', ['filter' =&gt; 'jwt'], static function ($routes) {
    // ...
});
$routes-&gt;get('users', 'UserController::list', ['filter' =&gt; 'jwt']);</code></pre>
<p>When the filter runs, it checks the <code>Authorization</code> header for a <code>Bearer</code> value
that has the JWT. It then validates the token. If the token is valid, it can
determine the correct user, which will then be available through an <code>auth()-&gt;user()</code>
call.</p>
<h2 id="method-references">Method References</h2>
<h3 id="generating-signed-jwts">Generating Signed JWTs</h3>
<h4 id="jwt-to-a-specific-user">JWT to a Specific User</h4>
<p>JWTs are created through the <code>JWTManager::generateToken()</code> method.
This takes a User object to give to the token as the first argument.
It can also take optional additional claims array, time to live in seconds,
a key group (an array key) in the <code>Config\AuthJWT::$keys</code>, and additional header
array:</p>
<pre class="highlight"><code class="language-php">public function generateToken(
    User $user,
    array $claims = [],
    ?int $ttl = null,
    $keyset = 'default',
    ?array $headers = null
): string</code></pre>
<p>The following code generates a JWT to the user.</p>
<pre class="highlight"><code class="language-php">use CodeIgniter\Shield\Authentication\JWTManager;

/** @var JWTManager $manager */
$manager = service('jwtmanager');

$user   = auth()-&gt;user();
$claims = [
    'email' =&gt; $user-&gt;email,
];
$jwt = $manager-&gt;generateToken($user, $claims);</code></pre>
<p>It sets the <code>Config\AuthJWT::$defaultClaims</code> to the token, and adds
the <code>'email'</code> claim and the user ID in the <code>"sub"</code> (subject) claim.
It also sets <code>"iat"</code> (Issued At) and <code>"exp"</code> (Expiration Time) claims automatically
if you don't specify.</p>
<h4 id="arbitrary-jwt">Arbitrary JWT</h4>
<p>You can generate arbitrary JWT with the <code>JWTManager::issue()</code> method.</p>
<p>It takes a JWT claims array, and can take time to live in seconds, a key group
(an array key) in the <code>Config\AuthJWT::$keys</code>, and additional header array:</p>
<pre class="highlight"><code class="language-php">public function issue(
    array $claims,
    ?int $ttl = null,
    $keyset = 'default',
    ?array $headers = null
): string</code></pre>
<p>The following code generates a JWT.</p>
<pre class="highlight"><code class="language-php">use CodeIgniter\Shield\Authentication\JWTManager;

/** @var JWTManager $manager */
$manager = service('jwtmanager');

$payload = [
    'user_id' =&gt; '1',
    'email'   =&gt; 'admin@example.jp',
];
$jwt = $manager-&gt;issue($payload, DAY);</code></pre>
<p>It uses the <code>secret</code> and <code>alg</code> in the <code>Config\AuthJWT::$keys['default']</code>.</p>
<p>It sets the <code>Config\AuthJWT::$defaultClaims</code> to the token, and sets
<code>"iat"</code> (Issued At) and <code>"exp"</code> (Expiration Time) claims automatically even if
you don't pass them.</p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
    <a href="https://github.com/codeigniter4/shield" target="_blank" rel="noopener" title="GitHub" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.sections"], "search": "../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.b4d07000.min.js"></script>
      
        <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.6.0/build/highlight.min.js"></script>
      
        <script src="../../assets/hljs.js"></script>
      
    
  </body>
</html>